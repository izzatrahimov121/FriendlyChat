<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FrendlyChat.az</title>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
          integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" integrity="sha512-5A8nwdMOWrSz20fDsjczgUidUBR8liPYU+WymTZP1lmY9G6Oc7HlZv156XqnsgNUzTyMefFTcsFH/tnJE/+xBg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" type="text/css" href="../assets/css/NotificatioStyle.css">

    <style>
        .user-list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px 0;
            margin-left: 6px;
        }

        .user-image {
            width: 40px;
            height: 40px;
            object-fit: contain;
            margin-right: 10px;
        }

        .user-name {
            margin-right: 10px;
        }
    </style>

    <!--Main Style-->
    <style>
        body {
            background-color: #83ceec;
            /*#F5F5F5;*/
        }

        .container {
            padding: 0;
            background-color: #FFF;
            box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
            height: 700px;
        }

        /* ===== MENU ===== */
        .menu {
            float: left;
            height: 700px;
            width: 70px;
            background: #4768b5;
            background: -webkit-linear-gradient(#4768b5, #35488e);
            background: -o-linear-gradient(#4768b5, #35488e);
            background: -moz-linear-gradient(#4768b5, #35488e);
            background: linear-gradient(#4768b5, #35488e);
            box-shadow: 0 10px 20px rgba(0,0,0,0.19);
        }

            .menu .items {
                list-style: none;
                margin: auto;
                padding: 0;
            }

                .menu .items .item {
                    height: 70px;
                    border-bottom: 1px solid #6780cc;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    color: #9fb5ef;
                    font-size: 17pt;
                }

                .menu .items .item-active {
                    background-color: #5172c3;
                    color: #FFF;
                }

                .menu .items .item:hover {
                    cursor: pointer;
                    background-color: #4f6ebd;
                    color: #cfe5ff;
                }

        /* === CONVERSATIONS === */

        .discussions {
            width: 35%;
            height: 700px;
            box-shadow: 0px 8px 10px rgba(0,0,0,0.20);
            overflow: auto;
            background-color: #87a3ec;
            display: inline-block;
        }

        .discussionsN {
            left: 5px;
            width: 90%;
            height: 700px;
            box-shadow: 0px 8px 10px rgba(0,0,0,0.20);
            overflow-y: scroll;
            overflow-x: hidden;
            background-color: #87a3ec;
            display: inline-block;
        }

        .discussions .discussion {
            width: 100%;
            height: 90px;
            background-color: #FAFAFA;
            border-bottom: solid 1px #E0E0E0;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .discussions .search {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #E0E0E0;
        }

            .discussions .search .searchbar {
                height: 40px;
                background-color: #FFF;
                width: 70%;
                padding: 0 20px;
                border-radius: 50px;
                border: 1px solid #EEEEEE;
                display: flex;
                align-items: center;
                cursor: pointer;
            }

                .discussions .search .searchbar input {
                    margin-left: 15px;
                    height: 38px;
                    width: 100%;
                    border: none;
                    font-family: 'Montserrat', sans-serif;
                    ;
                }

                .discussions .search .searchbar *::-webkit-input-placeholder {
                    color: #E0E0E0;
                }

                .discussions .search .searchbar input *:-moz-placeholder {
                    color: #E0E0E0;
                }

                .discussions .search .searchbar input *::-moz-placeholder {
                    color: #E0E0E0;
                }

                .discussions .search .searchbar input *:-ms-input-placeholder {
                    color: #E0E0E0;
                }

        .discussions .message-active {
            width: 97%;
            height: 90px;
            background-color: #aac8f1;
            border-bottom: solid 1px #E0E0E0;
        }

        .discussions .discussion .photo {
            margin-left: 20px;
            display: block;
            width: 45px;
            height: 45px;
            background: #E6E7ED;
            -moz-border-radius: 50px;
            -webkit-border-radius: 50px;
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
        }

        .online {
            position: relative;
            top: 30px;
            left: 35px;
            width: 13px;
            height: 13px;
            background-color: #8BC34A;
            border-radius: 13px;
            border: 3px solid #FAFAFA;
        }

        .desc-contact {
            height: 43px;
            width: 50%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .discussions .discussion .name {
            margin: 0 0 0 20px;
            font-family: 'Montserrat', sans-serif;
            font-size: 11pt;
            color: #515151;
        }

        .discussions .discussion .message {
            margin: 6px 0 0 20px;
            font-family: 'Montserrat', sans-serif;
            font-size: 9pt;
            color: #515151;
        }

        .timer {
            margin-left: 15%;
            font-family: 'Open Sans', sans-serif;
            font-size: 11px;
            padding: 3px 8px;
            color: #BBB;
            background-color: #0c5e1e;
            border: 1px solid #E5E5E5;
            border-radius: 15px;
        }

        .chat {
            width: calc(65% - 85px);
        }

        .header-chat {
            background-color: #FFF;
            height: 90px;
            box-shadow: 0px 3px 2px rgba(0,0,0,0.100);
            display: flex;
            align-items: center;
        }

        .chat .header-chat .icon {
            margin-left: 30px;
            color: #515151;
            font-size: 14pt;
        }

        .chat .header-chat .name {
            margin: 0 0 0 20px;
            font-family: 'Montserrat', sans-serif;
            font-size: 13pt;
            color: #515151;
        }

        .chat .header-chat .right {
            position: absolute;
            right: 40px;
        }

        .chat .messages-chat {
            padding: 25px 35px;
        }

            .chat .messages-chat .message {
                display: flex;
                align-items: center;
                margin-bottom: 5px;
            }

                .chat .messages-chat .message .photo {
                    display: block;
                    width: 45px;
                    height: 45px;
                    background: #E6E7ED;
                    -moz-border-radius: 50px;
                    -webkit-border-radius: 50px;
                    background-position: center;
                    background-size: cover;
                    background-repeat: no-repeat;
                }

            .chat .messages-chat .text {
                margin: 0 10px;
                background-color: #8bddf6;
                padding: 10px;
                border-radius: 12px;
            }

        .text-only {
            margin-left: 45px;
        }

        .time {
            font-size: 10px;
            color: lightgrey;
            margin-bottom: 10px;
            margin-left: 85px;
        }

        .response-time {
            float: right;
            margin-right: 40px !important;
        }

        .response {
            float: right;
            margin-right: 0px !important;
            margin-left: auto; /* flexbox alignment rule */
        }

            .response .text {
                background-color: #5fee4f !important;
            }

        .footer-chat {
            width: calc(65% - 66px);
            height: 80px;
            display: flex;
            align-items: center;
            position: absolute;
            bottom: 0;
            background-color: transparent;
            border-top: 2px solid #EEE;
        }

        .chat .footer-chat .icon {
            margin-left: 30px;
            color: #C0C0C0;
            font-size: 14pt;
        }

        .chat .footer-chat .send {
            color: #fff;
            background-color: #4f6ebd;
            position: absolute;
            right: 50px;
            padding: 12px 12px 12px 12px;
            border-radius: 50px;
            font-size: 14pt;
        }

        .chat .footer-chat .name {
            margin: 0 0 0 20px;
            text-transform: uppercase;
            font-family: 'Montserrat', sans-serif;
            font-size: 13pt;
            color: #515151;
        }

        .chat .footer-chat .right {
            position: absolute;
            right: 40px;
        }

        .write-message {
            border: none !important;
            width: 60%;
            height: 50px;
            margin-left: 20px;
            padding: 10px;
        }

        .footer-chat *::-webkit-input-placeholder {
            color: #C0C0C0;
            font-size: 13pt;
        }

        .footer-chat input *:-moz-placeholder {
            color: #C0C0C0;
            font-size: 13pt;
        }

        .footer-chat input *::-moz-placeholder {
            color: #C0C0C0;
            font-size: 13pt;
            margin-left: 5px;
        }

        .footer-chat input *:-ms-input-placeholder {
            color: #C0C0C0;
            font-size: 13pt;
        }

        .clickable {
            cursor: pointer;
        }
    </style>

    <!--Notification buttonsa sytle-->
    <style>
        .button-37 {
            background-color: #13aa52;
            border: 1px solid #13aa52;
            border-radius: 4px;
            box-shadow: rgba(0, 0, 0, .1) 0 2px 4px 0;
            box-sizing: border-box;
            color: #fff;
            cursor: pointer;
            font-family: "Akzidenz Grotesk BQ Medium", -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 16px;
            font-weight: 400;
            outline: none;
            outline: 0;
            padding: 10px 25px;
            text-align: center;
            transform: translateY(0);
            transition: transform 150ms, box-shadow 150ms;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

            .button-37:hover {
                box-shadow: rgba(0, 0, 0, .15) 0 3px 9px 0;
                transform: translateY(-2px);
            }

        .button-37-1 {
            background-color: #e62143;
            border: 1px solid #e62143;
            border-radius: 4px;
            box-shadow: rgba(0, 0, 0, .1) 0 2px 4px 0;
            box-sizing: border-box;
            color: #fff;
            cursor: pointer;
            font-family: "Akzidenz Grotesk BQ Medium", -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 16px;
            font-weight: 400;
            outline: none;
            outline: 0;
            padding: 10px 25px;
            text-align: center;
            transform: translateY(0);
            transition: transform 150ms, box-shadow 150ms;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

            .button-37-1:hover {
                box-shadow: rgba(0, 0, 0, .15) 0 3px 9px 0;
                transform: translateY(-2px);
            }
    </style>

    <!--Profil Style-->
    <style>
        .profile-head {
            transform: translateY(5rem)
        }

        .cover {
            background-image: url(https://images.unsplash.com/photo-1530305408560-82d13781b33a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1352&q=80);
            background-size: cover;
            background-repeat: no-repeat
        }
    </style>

    <!--The Modal Style-->
    <style>

        /* The Modal (background) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 400px; /* Full width */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
        }

        /* Modal Content (image) */
        .modal-content {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
        }

        /* Caption of Modal Image */
        #caption {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
            text-align: center;
            color: #ccc;
            padding: 10px 0;
            height: 150px;
        }

        /* Add Animation */
        .modal-content, #caption {
            -webkit-animation-name: zoom;
            -webkit-animation-duration: 0.6s;
            animation-name: zoom;
            animation-duration: 0.6s;
        }

        -webkit-keyframes zoom {
            from

        {
            -webkit-transform: scale(0)
        }

        to {
            -webkit-transform: scale(1)
        }

        }

        keyframes zoom {
            from

        {
            transform: scale(0)
        }

        to {
            transform: scale(1)
        }

        }

        /* The Close Button */
        .close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
        }

            .close:hover,
            .close:focus {
                color: #bbb;
                text-decoration: none;
                cursor: pointer;
            }

        /* 100% Image Width on Smaller Screens */
        media only screen and (max-width: 700px) {
            .modal-content

        {
            width: 100%;
        }

        }
    </style>

    <!--The Media Modal Style-->
    <style>

        /* The Modal (background) */
        .MediaModal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%;
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
        }

        /* Modal Content (image) */
        .MediaModal-content {
            margin: auto;
            display: block;
            width: 80%;
            object-fit: contain;
            max-width: 90%;
        }

        /* Add Animation */
        .MediaModal-content, #caption1 {
            -webkit-animation-name: zoom;
            -webkit-animation-duration: 0.6s;
            animation-name: zoom;
            animation-duration: 0.6s;
        }

        -webkit-keyframes zoom {
            from

        {
            -webkit-transform: scale(0)
        }

        to {
            -webkit-transform: scale(1)
        }

        }

        keyframes zoom {
            from

        {
            transform: scale(0)
        }

        to {
            transform: scale(1)
        }

        }

        /* The Close Button */
        .closeModal {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
        }

            .closeModal:hover,
            .closeModal:focus {
                color: #bbb;
                text-decoration: none;
                cursor: pointer;
            }

        /* 100% Image Width on Smaller Screens */
        media only screen and (max-width: 100%) {
            .MediaModal-content

        {
            width: 100%;
        }

        }
    </style>

</head>

<body>
    <div id="myMediaModal" class="MediaModal">
        <span class="closeModal">&times;</span>
        <img class="MediaModal-content" id="img">
    </div>
    <div style="margin-top:30px;">
        <div class="container">
            <div class="row">
                <nav class="menu">
                    <ul class="items">

                        <a asp-action="Index" asp-controller="Home" class="navitem item" style="color: inherit; text-decoration:none;">
                        <li id="li1" class="item-active">
                            <i class="fa fa-home" aria-hidden="true"></i>
                        </li>
                        </a>

                        <a asp-action="Index" asp-controller="Media" class="navitem item" style="color: inherit; text-decoration:none;">
                        <li id="li1" class="item-active">
                            <i class="fa-solid fa-photo-film"></i>
                        </li>
                        </a>

                        <a asp-action="Index" asp-controller="Profil" class="navitem item" style="color: inherit; text-decoration:none;">
                        <li id="li2">
                            <i class="fa fa-user" aria-hidden="true"></i>
                        </li>
                        </a>

                        <a asp-action="Index" asp-controller="Follow" class="navitem item" style="color: inherit; text-decoration:none;">
                        <li id="li3">
                            <i class="fas fa-user-plus" aria-hidden="true"></i>
                        </li>
                        </a>

                        <a id="notificationLink" asp-action="Index" asp-controller="Notification" class="navitem item " style="color: inherit; text-decoration:none;">
                        <li id="li4">
                            <i class="fa-solid fa-envelope" aria-hidden="true"></i>
                        </li>
                        </a>
                    </ul>
                </nav>
                @RenderBody()
            </div>
        </div>
    </div>

    <div id="myModal" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="img01">
        <div id="caption"></div>
    </div>


    <script src="~/assets/js/jquery-3.7.0.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/3.1.12/signalr.min.js"></script>
    <!--The Layout Script-->
    <script>
        $(document).ready(function () {
            var isnotification = "@ViewBag.IsNewNotification";
            if (isnotification == "yes") {
                $("#li4").find("i").removeClass("fa-envelope");
                $("#li4").find("i").addClass("fa-bell fa-beat-fade");
            }

            var menu = '@ViewBag.ActiveMenu';
            $(".navitem").find("li").removeClass("item-active");
            if (menu == "Home") {
                $("#li1").addClass("item-active");
            }
            if (menu == "Profil") {
                $("#li2").addClass("item-active");
            }
            if (menu == "Follow") {
                $("#li3").addClass("item-active");
            }
            if (menu == "Notification") {
                $("#li4").addClass("item-active");
            };
        });
    </script>
    <!--End Layout Script-->
    <!--The Home Script-->
    <script>
        $(document).ready(function () {
            var menu = '@ViewBag.ActiveMenu';
            if (menu == "Home") {
                $.ajax({
                    url: "/Home/GetUsers",
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        var html = '';
                        if (data != null) {
                            $.each(data, function (i, val) {
                                if (val.isOnline) {
                                    html += '<div onclick="GoChat(\'' + val.toUserName + '\',$(this))" class="discussion"><div class="photo" onclick="Modal(\'' + val.toUserImage + '\');event.stopPropagation()" style = "background-image: url(\'../assets/images/' + val.toUserImage + '\');" ><div data-username="' + val.toUserName + '" class="online" ></div></div><div class="desc-contact"><p class="name">' + val.toUserName + '</p><p class="message">' + val.lastMessage + '</p></div><div class="timer">' + val.newMessagesCount + '</div></div>';
                                }
                                else {
                                    html += '<div onclick="GoChat(\'' + val.toUserName + '\',$(this))" class="discussion"><div class="photo" onclick="Modal(\'' + val.toUserImage + '\');event.stopPropagation()" style = "background-image: url(\'../assets/images/' + val.toUserImage + '\');" ><div data-username="' + val.toUserName + '" class="" ></div></div><div class="desc-contact"><p class="name">' + val.toUserName + '</p><p class="message">' + val.lastMessage + '</p></div><div class="timer">' + val.newMessagesCount + '</div></div>';
                                }
                            });
                        };
                        $("#ChatBox").empty();
                        $("#ChatBox").append(html);
                    }
                });
            }
        });


        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/onlineusershub")
            .build();

        connection.on("UserConnected", function (username) {
            //console.log(username + " connected.");
            $("div[data-username='" + username + "']").addClass("online");
        });

        connection.on("UserDisconnected", function (username) {
            //console.log(username + " disconnected.");
            $("div[data-username='" + username + "']").removeClass("online");
        });
        connection.start();





        var GetAudio = new Audio("../assets/audio/get.mp3")
        function GoChat(name, el) {
            $(".message-active").removeClass("message-active");
            el.addClass("message-active");
            $(".write-message").each(function () {
                $(this).removeData("touser");
            });
            $(".chat-icon").css("display", "none");
            $(".header-chat").css("display", "flex");
            $("#header-name").text(name);
            $.ajax({
                url: "Home/GetOldChat",
                type: "GET",
                dataType: "json",
                data: { toUserName: name },
                success: function (data) {
                    var html = '';
                    $.each(data, function (i, val) {
                        if (val.fromUserName != name) {
                            if (val.date != null) {
                                html += '<div class="message" style="justify-content: center;"><p class="text" style = "background-color: #a71694;">' + val.date + '</p></div>'
                            }
                            html += '<div class="message"><p style="font-size:10px;">' + val.time + '</p><p class="text" style="max-width:300px; word-wrap: break-word;">' + val.message + '</p></div>';
                        }
                        else {
                            if (val.date != null) {
                                html += '<div class="message" style="justify-content: center;"><p class="text" style = "background-color: #a71694;">' + val.date + '</p></div>'
                            }
                            html += '<div class="message"><div class="response"><p class="text" style="max-width:300px; word-wrap: break-word;">' + val.message + '</p></div><p style="font-size:10px;">' + val.time + '</p></div>';
                        }
                    });
                    $('.messages-chat').empty();
                    $('.messages-chat').append(html);
                    $('.messages-chat').scrollTop($('.messages-chat').prop("scrollHeight"));
                    $('.timer').empty();
                }
            });
            $('.messages-chat').css("display", "block");
            $(".footer-chat").css("display", "block");
            $(".write-message").attr("data-toUser", name);

            //------new message-----
            setInterval(function () {
                $.ajax({
                    url: "Home/GetNewMessage",
                    type: "GET",
                    data: { toUserName: name },
                    dataType: "json",
                    success: function (data) {
                        if (data.length != 0) {
                            var html = '';
                            $.each(data, function (i, val) {
                                html += '<div class="message"><p style="font-size:10px;">' + val.time + '</p><p class="text" style="max-width:300px; word-wrap: break-word;">' + val.message + '</p></div>';
                            });
                            GetAudio.play();
                            $('.messages-chat').append(html);
                            $('.messages-chat').scrollTop($('.messages-chat').prop("scrollHeight"))
                        }
                    }
                });
            }, 1000);
        };


        //-------------send message------
        var SendAudio = new Audio("../assets/audio/send.mp3");
        $(".write-message").on("keydown", function (event) {
            if (event.keyCode === 13) { // Enter click
                var inputValue = $(this).val();
                if ($.trim(inputValue) !== "") {
                    var toUser = $(".write-message").data("touser");
                    $.ajax({
                        url: "/Home/SendMessage",
                        type: "POST",
                        data: { toUserName: toUser, content: inputValue },
                        success: function () {
                            var now = new Date();
                            var html = '<div class="message" ><div class="response"><p class="text" style="max-width:300px; word-wrap: break-word;">' + inputValue + '</p></div><p style="font-size:10px;">' + now.getHours() + ':' + now.getMinutes() + '</p></div>';
                            $('.messages-chat').append(html);
                            $('.messages-chat').scrollTop($('.messages-chat').prop("scrollHeight"))
                            SendAudio.play();
                            $(".write-message").val("");
                        }
                    });
                }
            }
        });
    </script>
    <!--End Home Script-->
    <!--The Notification Script-->
    <script>
        $(document).ready(function () {
            var menu = '@ViewBag.ActiveMenu';
            if (menu == "Notification") {
                $.ajax({
                    url: "/Notification/GetNotifications",
                    type: "Get",
                    dataType: "json",
                    success: function (data) {
                        var html = '';
                        if (data != null) {
                            $.each(data, function (i, val) {
                                html += '<div class="notification-list notification-list--unread" style="height:90px;width:900px;margin-left:15px;"><div class="notification-list_content"><div class="notification-list_img"><img class="myimg11" onclick="Modal(\'' + val.image + '\')" src="../assets/images/' + val.image + '" alt="user"></div><div class="notification-list_detail"><p style="margin-top:15px; font-size:20px"><b>' + val.fromUser + '</b> sent you a friend request-  ->' + val.date + '</p></div></div><div class="notification-list_feature-img buttons"><button class="btn button-37" onclick="Accept(\'' + val.fromUser + '\',$(this))" role="button">Accept</button><button class="btn button-37-1" onclick="Reject(\'' + val.fromUser + '\',$(this))" role="button">Reject</button></div></div>';
                            });
                        }
                        else {
                            html += '<img src="../assets/images/nonotification.jpg" alt="user" style="width:300px;margin-left:300px;">';
                        }
                        $('#notification_box').empty();
                        $('#notification_box').append(html);
                    }
                });
            }
        });

        function Accept(name, el) {
            el.prop('disabled', true);
            $.ajax({
                url: "/Follow/ToAcceptRequest",
                type: "POST",
                data: { username: name },
                success: function () {
                    el.closest('.notification-list').css('display', 'none');
                }
            });
        }

        function Reject(name, el) {
            el.prop('disabled', true);
            $.ajax({
                url: "/Follow/ToRejectRequest",
                type: "POST",
                data: { username: name },
                success: function () {
                    el.closest('.notification-list').css('display', 'none');
                }
            });
        }


        //The Modal Script------ >
        var modal = document.getElementById("myModal");
        var modalImg = document.getElementById("img01");
        var captionText = document.getElementById("caption");
        function Modal(image) {
            modal.style.display = "block";
            modalImg.src = "../assets/images/" + image;
        };
        var span = document.getElementsByClassName("close")[0];
        span.onclick = function () {
            modal.style.display = "none";
        }
        //End Modal Script------ >

        //The Media Modal Script-------------->
        var modal = document.getElementById("myMediaModal");
        var modalImg = document.getElementById("img");
        var captionText = document.getElementById("caption1");
        function MediaModal(image) {
            modal.style.display = "block";
            modalImg.src = "../assets/media/photos/" + image;
        };
        var span = document.getElementsByClassName("closeModal")[0];
        span.onclick = function () {
            modal.style.display = "none";
        }
        //End Media Modal Script-------------->


    </script>
    <!--End Notification Script-->
    <!--The Follow Script-->
    <script>
        $(document).ready(function () {
            $("#search").keyup(function () {
                var username = $("#search").val();
                $.ajax({
                    url: "/Follow/SearchByUsername",
                    type: "GET",
                    data: { username: username },
                    dataType: "json",
                    success: function (data) {
                        var html = "";
                        if (data != null) {
                            $.each(data, function (i, val) {
                                if (val.requestStatus == "sendRequest") {
                                    html += '<div class="card"><div class="card-body"style="display:flex;justify-content: space-between;"><div style="display: flex; align-items: center;"><img onclick="Modal(\'' + val.image + '\')" src="../assets/images/' + val.image + '"alt="user"style="width:40px;height:40px;"/><p style="margin-left:20px;margin-top:5px;font-size:20px;font-weight:bold;">' + val.userName + '</p></div><div style="display: flex; align-items: center;"><button class="btn btn-success"  onclick="SendRequest(\'' + val.userName + '\',$(this))" >Send follow request</button><button style="display:none;" class="btn btn-secondary" onclick="WithdrawRequest(\'' + val.userName + '\',$(this))">Withdraw the request</button></div></div></div>';
                                }
                                else if (val.requestStatus == "requested") {
                                    html += '<div class="card"><div class="card-body"style="display:flex;justify-content: space-between;"><div style="display: flex; align-items: center;"><img onclick="Modal(\'' + val.image + '\')" src="../assets/images/' + val.image + '"alt="user"style="width:40px;height:40px;"/><p style="margin-left:20px;margin-top:5px;font-size:20px;font-weight:bold;">' + val.userName + '</p></div><div style="display: flex; align-items: center;"><button class="btn btn-secondary" onclick="WithdrawRequest(\'' + val.userName + '\',$(this))">Withdraw the request</button><button style="display:none;" class="btn btn-success"  onclick="SendRequest(\'' + val.userName + '\',$(this))" >Send follow request</button></div></div></div>';
                                }
                                else {//followed
                                    html += '<div class="card"><div class="card-body"style="display:flex;justify-content: space-between;"><div style="display: flex; align-items: center;"><img onclick="Modal(\'' + val.image + '\')" src="../assets/images/' + val.image + '"alt="user"style="width:40px;height:40px;"/><p style="margin-left:20px;margin-top:5px;font-size:20px;font-weight:bold;">' + val.userName + '</p></div><div style="display: flex; align-items: center;"><button class="btn btn-danger" onclick="DeleteFollowUp(\'' + val.userName + '\',$(this))">Do not follow</button><button class="btn btn-success" style="display:none;" onclick="SendRequest(\'' + val.userName + '\',$(this))" >Send follow request</button><button class="btn btn-secondary" style="display:none;" onclick="WithdrawRequest(\'' + val.userName + '\',$(this))">Withdraw the request</button></div></div></div>';
                                }
                            });
                        }
                        else {
                            console.log("1sq");
                            html += '<div class="card"><div class="card-body"style="display:-webkit-box;display:-ms-flexbox;display:flex;"><p>Heç bir netice yoxdur</p>';
                        }
                        $('#search_box').empty();
                        $('#search_box').append(html);
                    }
                });
            });
        });
        function SendRequest(name, el) {
            el.prop('disabled', true);
            $.ajax({
                url: "/Follow/SendFollowRequest",
                type: "POST",
                data: { username: name },
                success: function () {
                    el.css("display", "none");
                    el.closest('.card-body').find('.btn-secondary').show();
                    el.closest('.card-body').find('.btn-secondary').prop('disabled', false);
                }
            });
        };
        function WithdrawRequest(name, el) {
            el.prop('disabled', true);
            $.ajax({
                url: "/Follow/WithdrawFollowRequest",
                type: "POST",
                data: { username: name },
                success: function () {
                    el.css("display", "none");
                    el.closest('.card-body').find('.btn-success').show();
                    el.closest('.card-body').find('.btn-success').prop('disabled', false);
                }
            });
        };
        function DeleteFollowUp(name, el) {
            el.prop('disabled', true);
            $.ajax({
                url: "/Follow/DeleteFollowUp",
                type: "POST",
                data: { username: name },
                success: function () {
                    el.css("display", "none");
                    el.closest('.card-body').find('.btn-success').show();
                    el.closest('.card-body').find('.btn-success').prop('disabled', false);
                }
            });
        };


    </script>
    <!--End Follow Script-->
    <!--The Profile Script-->
    <script>

        $("#editProfil, #closeform").click(function () {
            $("#editform").toggle();
            $("#followList").css("display", "none");
        });
        $("#changeinfo").click(function () {
            $("#editform input").prop("disabled", false);
        });
        $("#closefollowlist").click(function () {
            $("#followList").css("display", "none");
        });


        $("#Followers").click(function () {
            $("#editform").css("display", "none");
            $("#followList").css("display", "block");
            $.ajax({
                url: "/Profil/GetFollowers",
                type: "GET",
                dataType: "json",
                success: function (data) {
                    var html = "";
                    if (data != null) {
                        $.each(data, function (i, val) {
                            html += '<li class="list-group-item d-flex justify-content-between align-items-center"><div class="d-flex align-items-center"><img src="../assets/images/' + val.followingUserImage + '" style = "width: 45px; height: 45px" class="rounded-circle" /><div class="ms-3" ><p class="fw-bold mb-1" > ' + val.followingUserName + ' </p><p class="text-muted mb-0" >' + val.followingUserEmail + '</p></div></div></li>'
                        });
                    }
                    $("#follogingList").empty();
                    $("#follogingList").append(html);
                }
            });
        });
        $("#Following").click(function () {
            $("#editform").css("display", "none");
            $("#followList").css("display", "block");
            $.ajax({
                url: "/Profil/GetFollowing",
                type: "GET",
                dataType: "json",
                success: function (data) {
                    var html = "";
                    if (data != null) {
                        $.each(data, function (i, val) {
                            html += '<li class="list-group-item d-flex justify-content-between align-items-center"><div class="d-flex align-items-center"><img src="../assets/images/' + val.followingUserImage + '" style = "width: 45px; height: 45px" class="rounded-circle" /><div class="ms-3" ><p class="fw-bold mb-1" > ' + val.followingUserName + ' </p><p class="text-muted mb-0" >' + val.followingUserEmail + '</p></div></div></li>'
                        });
                    }
                    $("#follogingList").empty();
                    $("#follogingList").append(html);
                }
            });
        });
    </script>
    <!--End Profile Script-->
</body>
</html>
